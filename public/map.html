<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta charset="utf-8">
		<title>Reverse Geocoding</title>
		<style>
			html, body, #map-canvas {
			height: 100%;
			margin: 0px;
			padding: 10px
			}
			#panel {
				position: absolute;
				top: 5px; 
				left: 50%;
	 			margin-left: -180px;
				z-index: 5;
				background-color: #fff;
			padding: 5px;
					border: 1px solid #999;
			}
		</style>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="http://localhost:3000/socket.io/socket.io.js"></script>
		<script>
			var geocoder;
			var map;
			var infowindow = new google.maps.InfoWindow();
			var marker;
			
			function initialize() {
				geocoder = new google.maps.Geocoder();
				var latlng = new google.maps.LatLng(40.730885,-73.997383);
				var mapOptions = {
					zoom: 18,
					center: latlng,
					mapTypeId: 'roadmap'
				}
				map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
			}

			function codeLatLngAjax() {
				var lat;
				var lng;
				var latlng;
				var ajaxVehicleId = document.getElementById('ajaxVehicleId').value;

				$(document).ready(function(){
					$.ajax({
	 					url: 'http://localhost:3000/getVehicleLocationAjax',
						type: 'GET',
						dataType: 'json',
						data: {"id": ajaxVehicleId},
						error: function(xhr,status, error){
							console.log(status);
						},
						success: function (result) {
							console.log(result[0].location.latitude);
							lat = result[0].location.latitude;
	 						lng = result[0].location.longitude;
							latlng = new google.maps.LatLng(lat, lng);
							geocoder.geocode({'latLng': latlng}, function(results, status) {
	          					if (status == google.maps.GeocoderStatus.OK) {
									if (results[1]) {
										map.setZoom(18);
										marker = new google.maps.Marker({
											position: latlng,
											ap: map
										});
										infowindow.setContent(results[1].formatted_address);
										infowindow.open(map, marker);
									} 
									else {
										alert('No results found');
									}
								}
								else {
									alert('Geocoder failed due to: ' + status);
								}
							});
						}
					});
				});
			}
			google.maps.event.addDomListener(window, 'load', initialize);
		</script>
		<script>
    		function codeLatLngSocket(){
    			$(document).ready(function(){
    				console.log("CLIENT");
    				var socket = io.connect("http://localhost:3000/");
      				socket.on('news', function (data) {
						console.log(JSON.stringify(data));
						socket.emit('my other event', { id: 52 });
					});	
					// socket.emit('id',42);
    			});
    		}
     	</script>

		<style>
			#panel {
				position: absolute;
				top: 5px;
				left: 50%;
				margin-left: -180px;
				width: 350px;
				z-index: 5;
				background-color: #fff;
				padding: 5px;
				border: 1px solid #999;
			}
			#latlng {
				width: 235px;
			}
		</style>
	</head>

	<body>
		<div id="panel">
			<input id="ajaxVehicleId" type="text" value="1">
			<input type="button" value="AJAX: Vehicle ID " onclick="codeLatLngAjax()">
	    	<input id="socketVehicleId" type="text" value="1">
			<input type="button" value="SOCKET: Vehicle ID " onclick="codeLatLngSocket()">
	    </div>
	    <!-- <div id="map-canvas"></div> -->
	</body>
</html>